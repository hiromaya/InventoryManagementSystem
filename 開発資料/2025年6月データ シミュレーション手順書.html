<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>在庫管理システム - 新しい運用手順ガイド（初期在庫読込から日次処理まで）</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            text-align: center;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }
        
        .header h1 {
            color: #2c3e50;
            font-size: 2.5rem;
            margin-bottom: 10px;
            background: linear-gradient(45deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .header p {
            color: #666;
            font-size: 1.1rem;
        }
        
        .data-info {
            background: rgba(52, 152, 219, 0.1);
            border-left: 4px solid #3498db;
            padding: 20px;
            margin-bottom: 30px;
            border-radius: 8px;
            backdrop-filter: blur(10px);
        }
        
        .phase {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease;
        }
        
        .phase:hover {
            transform: translateY(-5px);
        }
        
        .phase-header {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #ecf0f1;
        }
        
        .phase-number {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 1.2rem;
            margin-right: 20px;
        }
        
        .phase-title {
            font-size: 1.5rem;
            color: #2c3e50;
            font-weight: 600;
        }
        
        .command-block {
            background: #1e1e1e;
            color: #f8f8f2;
            padding: 20px;
            border-radius: 8px;
            margin: 15px 0;
            font-family: 'Courier New', monospace;
            position: relative;
            overflow-x: auto;
            cursor: pointer;
        }
        
        .command-block::before {
            content: 'PowerShell (Click to Copy)';
            position: absolute;
            top: 5px;
            right: 10px;
            background: #007acc;
            color: white;
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 0.8rem;
        }
        
        .command-line {
            margin: 8px 0;
            display: block;
        }
        
        .comment {
            color: #6a9955;
            font-style: italic;
        }
        
        .step {
            background: rgba(46, 204, 113, 0.1);
            border-left: 4px solid #2ecc71;
            padding: 15px;
            margin: 15px 0;
            border-radius: 5px;
        }
        
        .warning {
            background: rgba(231, 76, 60, 0.1);
            border-left: 4px solid #e74c3c;
            padding: 15px;
            margin: 15px 0;
            border-radius: 5px;
        }
        
        .info {
            background: rgba(52, 152, 219, 0.1);
            border-left: 4px solid #3498db;
            padding: 15px;
            margin: 15px 0;
            border-radius: 5px;
        }
        
        .success {
            background: rgba(46, 204, 113, 0.1);
            border-left: 4px solid #2ecc71;
            padding: 15px;
            margin: 15px 0;
            border-radius: 5px;
        }
        
        .verification {
            background: rgba(142, 68, 173, 0.1);
            border-left: 4px solid #8e44ad;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
        }
        
        .timeline {
            position: relative;
            padding-left: 30px;
        }
        
        .timeline::before {
            content: '';
            position: absolute;
            left: 15px;
            top: 0;
            bottom: 0;
            width: 2px;
            background: linear-gradient(to bottom, #667eea, #764ba2);
        }
        
        .timeline-item {
            position: relative;
            margin-bottom: 20px;
        }
        
        .timeline-item::before {
            content: '';
            position: absolute;
            left: -22px;
            top: 5px;
            width: 12px;
            height: 12px;
            background: #667eea;
            border-radius: 50%;
            border: 3px solid white;
        }
        
        .date-range {
            display: inline-block;
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            padding: 5px 12px;
            border-radius: 20px;
            font-weight: bold;
            margin: 5px;
        }
        
        .troubleshooting {
            background: rgba(241, 196, 15, 0.1);
            border: 2px solid #f1c40f;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #ecf0f1;
        }
        
        th {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            font-weight: 600;
        }
        
        tr:hover {
            background: rgba(52, 152, 219, 0.05);
        }
        
        .button {
            display: inline-block;
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            padding: 12px 24px;
            border-radius: 25px;
            text-decoration: none;
            font-weight: 600;
            transition: all 0.3s ease;
            border: none;
            cursor: pointer;
        }
        
        .button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }
        
        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .phase {
                padding: 20px;
            }
            
            .command-block {
                font-size: 0.9rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>📋 在庫管理システム</h1>
            <p>新しい運用手順ガイド（初期在庫読込から日次処理まで）</p>
            <p><strong>最終更新:</strong> 2025年7月19日 - DailyCloseManagement完全実装対応 | <strong>対象:</strong> 開発・運用</p>
        </div>

        <div class="phase" style="background: linear-gradient(135deg, #3498db 0%, #2c3e50 100%); color: white;">
            <div class="phase-header">
                <div class="phase-number" style="background: white; color: #3498db;">🎯</div>
                <div class="phase-title" style="color: white;">Phase 1: 初期導入（システム開始時のみ）</div>
            </div>
            
            <div class="step" style="background: rgba(255, 255, 255, 0.1); border: 1px solid rgba(255, 255, 255, 0.3);">
                <h4 style="color: white;">Step 1: データベース準備</h4>
                <div class="command-block">
<span class="comment"># データベース初期化（必要な場合のみ）</span>
<span class="command-line">dotnet run init-database --force</span>

<span class="comment"># 接続確認</span>
<span class="command-line">dotnet run test-connection</span>
                </div>
            </div>

            <div class="step" style="background: rgba(255, 255, 255, 0.1); border: 1px solid rgba(255, 255, 255, 0.3);">
                <h4 style="color: white;">Step 2: 移行用在庫マスタの読込（最重要）</h4>
                <div class="warning" style="background: rgba(255, 255, 255, 0.1); border: 1px solid rgba(255, 255, 255, 0.3); margin-bottom: 20px;">
                    <strong style="color: white;">⚠️ 重要な変更点：</strong>
                    <p style="color: white;">前月末在庫.csvではなく、<strong>ZAIK*.csv（移行用在庫マスタ）</strong>を使用します。</p>
                </div>
                <div class="command-block">
<span class="comment"># ZAIK*.csvをD:\InventoryImport\DeptA\Import\に配置</span>
<span class="comment"># 例: ZAIK20250531.csv （2025年5月31日の在庫データ）</span>

<span class="comment"># 移行用在庫マスタを読込</span>
<span class="command-line">dotnet run import-initial-inventory DeptA</span>

<span class="comment"># 登録確認</span>
<span class="command-line">dotnet run check-data-status</span>
                </div>
                <div class="success" style="margin-top: 15px; background: rgba(255, 255, 255, 0.1); border: 1px solid rgba(255, 255, 255, 0.3);">
                    <strong style="color: white;">✅ 重要ポイント:</strong>
                    <ul style="color: white;">
                        <li>ファイル名から自動的に日付を抽出（ZAIK20250531.csv → 2025-05-31）</li>
                        <li>PersonInChargeCode（担当者コード）とAveragePrice（平均単価）も自動設定</li>
                        <li>DataSetIdが自動的に付与されます（形式: INITIAL_YYYYMMDD_HHmmss）</li>
                        <li>重複実行しても安全です（既存の初期データは自動的に無効化）</li>
                        <li>トランザクション管理により、処理の原子性が保証されます</li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="phase" style="background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%); color: white;">
            <div class="phase-header">
                <div class="phase-number" style="background: white; color: #e74c3c;">🎯</div>
                <div class="phase-title" style="color: white;">Phase 2: 月初処理（6月1日）</div>
            </div>
            
            <div class="info" style="background: rgba(255, 255, 255, 0.2); border: 1px solid rgba(255, 255, 255, 0.3); margin-bottom: 20px;">
                <h4 style="color: white;">🆕 import-folderコマンドの自動引継機能</h4>
                <p style="color: white;">import-folderコマンドは、在庫影響伝票（売上・仕入・在庫調整）の件数を自動的に確認し、処理モードを切り替えます。</p>
                <ul style="color: white;">
                    <li><strong>伝票データがある日（1件以上）</strong>：通常の在庫マスタ最適化（DataSetId: AUTO_OPTIMIZE_*）</li>
                    <li><strong>伝票データがない日（0件）</strong>：前日在庫引継モード（DataSetId: CARRYOVER_*）</li>
                </ul>
                <p style="color: white; margin-top: 10px;">これにより、週末・祝日・年末年始でも平日と同じコマンドで処理できます。</p>
            </div>
            
            <div class="step" style="background: rgba(255, 255, 255, 0.1); border: 1px solid rgba(255, 255, 255, 0.3);">
                <h4 style="color: white;">Step 1: 6月1日の処理（伝票の有無に関わらず同じコマンド）</h4>
                <div class="command-block">
<span class="comment"># import-folderが自動的に処理モードを判断</span>
<span class="comment"># - 伝票データがあれば：通常の取込と在庫最適化</span>
<span class="comment"># - 伝票データがなければ：前日在庫を自動引継</span>
<span class="command-line">dotnet run import-folder DeptA 2025-06-01</span>
                </div>
                <p style="color: white; margin-top: 10px;">→ 6月1日（土）は伝票0件なので、自動的に5/31の在庫を引き継ぎます</p>
                <div class="success" style="margin-top: 10px; background: rgba(255, 255, 255, 0.1); border: 1px solid rgba(255, 255, 255, 0.3);">
                    <strong style="color: white;">ログ出力例（自動引継モード）：</strong>
                    <pre style="background: rgba(0, 0, 0, 0.2); padding: 10px; border-radius: 5px; color: white;">
[2025-06-01] 在庫影響伝票が0件のため、前日在庫引継モードで処理します。
  売上: 0件, 仕入: 0件, 在庫調整: 0件
前日（2025-05-31）の在庫を引き継ぎます。
✅ 前日在庫引継完了 [2025-06-01]
   - 引継在庫数: 1234件
   - DataSetId: CARRYOVER_20250601_090000_ABC123</pre>
                </div>
            </div>

            <div class="step" style="background: rgba(255, 255, 255, 0.1); border: 1px solid rgba(255, 255, 255, 0.3);">
                <h4 style="color: white;">Step 2: 6月1日の帳票作成</h4>
                <div class="command-block">
<span class="comment"># アンマッチリスト（累積管理のため日付指定不要）</span>
<span class="command-line">dotnet run unmatch-list</span>

<span class="comment"># 商品日報</span>
<span class="command-line">.\dev.ps1 dev-daily-report 2025-06-01</span>

<span class="comment"># 在庫表（必要に応じて）</span>
<span class="command-line">dotnet run inventory-list 2025-06-01</span>

<span class="comment"># 日次終了処理（重要）</span>
<span class="command-line">.\dev.ps1 dev-daily-close 2025-06-01</span>
                </div>
            </div>
        </div>

        <div class="phase" style="background: linear-gradient(135deg, #27ae60 0%, #16a085 100%); color: white;">
            <div class="phase-header">
                <div class="phase-number" style="background: white; color: #27ae60;">🎯</div>
                <div class="phase-title" style="color: white;">Phase 3: 日次処理（6月2日以降）</div>
            </div>
            
            <div class="info" style="background: rgba(255, 255, 255, 0.2); border: 1px solid rgba(255, 255, 255, 0.3);">
                <h4 style="color: white;">📝 統一されたシンプルな処理方法</h4>
                <p style="color: white;">import-folderコマンドの自動引継機能により、伝票の有無に関わらず同じコマンドで処理できます。</p>
            </div>

            <div class="step" style="background: rgba(255, 255, 255, 0.1); border: 1px solid rgba(255, 255, 255, 0.3);">
                <h4 style="color: white;">標準的な日次処理フロー（統一コマンド）</h4>
                <div class="command-block">
<span class="comment"># 1. 伝票データインポート（伝票がない場合は自動的に前日在庫引継）</span>
<span class="command-line">dotnet run import-folder DeptA 2025-06-02</span>

<span class="comment"># 2. アンマッチリスト作成（累積管理）</span>
<span class="command-line">dotnet run unmatch-list</span>

<span class="comment"># 3. 商品日報作成</span>
<span class="command-line">.\dev.ps1 dev-daily-report 2025-06-02</span>

<span class="comment"># 4. 日次終了処理（重要：必ず実行）</span>
<span class="command-line">.\dev.ps1 dev-daily-close 2025-06-02</span>
                </div>
                <div class="success" style="margin-top: 15px; background: rgba(255, 255, 255, 0.1); border: 1px solid rgba(255, 255, 255, 0.3);">
                    <strong style="color: white;">✨ 自動引継機能のメリット：</strong>
                    <ul style="color: white;">
                        <li>伝票の有無を事前に確認する必要がない</li>
                        <li>週末・祝日・年末年始でも同じコマンドで処理可能</li>
                        <li>処理モードは自動判定され、ログで確認可能</li>
                        <li>人為的ミスを防ぎ、運用を簡素化</li>
                    </ul>
                </div>
            </div>

            <div class="step" style="background: rgba(255, 255, 255, 0.1); border: 1px solid rgba(255, 255, 255, 0.3);">
                <h4 style="color: white;">処理モードの自動判定ログ例</h4>
                <div class="info" style="background: rgba(255, 255, 255, 0.1); border: 1px solid rgba(255, 255, 255, 0.3);">
                    <p style="color: white;"><strong>通常モード（伝票あり）の場合：</strong></p>
                    <pre style="background: rgba(0, 0, 0, 0.2); padding: 10px; border-radius: 5px; color: white;">
[2025-06-02] 在庫マスタ最適化を開始します。
  売上: 150件, 仕入: 200件, 在庫調整: 10件
✅ 在庫マスタ最適化完了 [2025-06-02] (1234ms)
   - DataSetId: AUTO_OPTIMIZE_20250602_090000</pre>
                    
                    <p style="margin-top: 15px; color: white;"><strong>引継モード（伝票なし）の場合：</strong></p>
                    <pre style="background: rgba(0, 0, 0, 0.2); padding: 10px; border-radius: 5px; color: white;">
[2025-06-02] 在庫影響伝票が0件のため、前日在庫引継モードで処理します。
  売上: 0件, 仕入: 0件, 在庫調整: 0件
✅ 前日在庫引継完了 [2025-06-02]
   - DataSetId: CARRYOVER_20250602_090000_XYZ789</pre>
                </div>
            </div>
        </div>

        <div class="phase">
            <div class="phase-header">
                <div class="phase-number">🔄</div>
                <div class="phase-title">移行用在庫マスタの詳細仕様</div>
            </div>

            <div class="info">
                <h4>📋 ZAIK*.csvファイルの特徴</h4>
                <ul>
                    <li><strong>ファイル名形式</strong>: ZAIK{YYYYMMDD}.csv（例: ZAIK20250531.csv）</li>
                    <li><strong>内容</strong>: 販売大臣からエクスポートした在庫データ</li>
                    <li><strong>日付</strong>: ファイル名から自動抽出される</li>
                    <li><strong>用途</strong>: システム開始時の初期在庫設定</li>
                </ul>
            </div>

            <div class="step">
                <h4>移行用在庫マスタの処理内容</h4>
                <table>
                    <thead>
                        <tr>
                            <th>項目</th>
                            <th>説明</th>
                            <th>設定値</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>JobDate</td>
                            <td>処理対象日</td>
                            <td>ファイル名から自動抽出</td>
                        </tr>
                        <tr>
                            <td>DataSetId</td>
                            <td>データセット識別子</td>
                            <td>INITIAL_{YYYYMMDD}_{HHmmss}</td>
                        </tr>
                        <tr>
                            <td>ImportType</td>
                            <td>インポート種別</td>
                            <td>INITIAL</td>
                        </tr>
                        <tr>
                            <td>PersonInChargeCode</td>
                            <td>担当者コード</td>
                            <td>CSVから取得</td>
                        </tr>
                        <tr>
                            <td>AveragePrice</td>
                            <td>平均単価</td>
                            <td>CSVから取得</td>
                        </tr>
                        <tr>
                            <td>CurrentStock</td>
                            <td>当日在庫数量</td>
                            <td>CSVの在庫数量</td>
                        </tr>
                        <tr>
                            <td>CurrentStockAmount</td>
                            <td>当日在庫金額</td>
                            <td>CSVの在庫金額</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <div class="warning">
                <h4>⚠️ 従来の前月末在庫.csvとの違い</h4>
                <ul>
                    <li><strong>前月末在庫.csv</strong>: import-folderコマンドでスキップされる</li>
                    <li><strong>ZAIK*.csv</strong>: import-initial-inventoryコマンド専用</li>
                    <li>前月末在庫.csvは今後使用しません</li>
                    <li>移行時は必ずZAIK*.csvを使用してください</li>
                </ul>
            </div>
        </div>

        <div class="phase">
            <div class="phase-header">
                <div class="phase-number">📊</div>
                <div class="phase-title">日次処理シミュレーション</div>
            </div>

            <div class="warning">
                <h4>🔴 在庫繰り越しの重要性</h4>
                <p><strong>日次終了処理（daily-close）</strong>は、在庫管理システムの核心機能です。</p>
                <ul>
                    <li><strong>目的：</strong>当日の在庫数量・金額を翌日の前日在庫として設定</li>
                    <li><strong>実行タイミング：</strong>商品日報作成後（通常15:00以降、開発ではいつでも可）</li>
                    <li><strong>未実行の影響：</strong>
                        <ul>
                            <li>翌日の前日在庫が0となり、全商品がアンマッチに</li>
                            <li>粗利計算が正しく行われない</li>
                            <li>在庫数量が負値になる可能性</li>
                        </ul>
                    </li>
                </ul>
            </div>

            <div class="info">
                <strong>📝 処理順序:</strong> import-initial-inventory → import-folder → unmatch-list → daily-report → inventory-list → <span style="color: #e74c3c; font-weight: bold;">daily-close</span>
                <br><br>
                <strong>💡 注意:</strong> 初期在庫設定にはimport-initial-inventoryコマンドを使用し、その後の日次処理はimport-folderコマンドを使用してください。
                <br><br>
                <strong>🔵 重要な変更:</strong> unmatch-listコマンドは日付パラメータが不要になりました。全期間の伝票データを対象に累積管理を行います。
                <br><br>
                <strong>🆕 新機能:</strong> import-folderコマンドは伝票データが0件の場合、自動的に前日在庫を引き継ぎます。週末や祝日でも同じコマンドで処理可能です。
                <br><br>
                <strong>📝 注意:</strong> 「データが存在しません」エラーが出た場合は、先にデータインポートを実行するか、<code>--skip-validation</code>オプションを使用してください。
            </div>

            <div class="timeline">
                <div class="timeline-item">
                    <h4>システム開始前の準備（移行用在庫マスタ読込）</h4>
                    <div class="info" style="margin-bottom: 15px;">
                        <strong>重要：</strong> システム開始前に、移行用在庫マスタ（ZAIK*.csv）を読み込んでください。
                    </div>
                    <div class="command-block">
<span class="comment"># ZAIK*.csvファイルを配置</span>
<span class="command-line">copy ZAIK20250531.csv D:\InventoryImport\DeptA\Import\</span>

<span class="comment"># 移行用在庫マスタ読込</span>
<span class="command-line">dotnet run import-initial-inventory DeptA</span>

<span class="comment"># 読込結果確認</span>
<span class="command-line">dotnet run check-data-status</span>
                    </div>
                    <div class="success" style="margin-top: 15px;">
                        <strong>✅ 読込完了後の確認事項：</strong>
                        <ul>
                            <li>InventoryMasterテーブルに初期在庫データが登録されること</li>
                            <li>DataSetIdがINITIAL_*形式で設定されること</li>
                            <li>PersonInChargeCodeとAveragePriceが正しく設定されること</li>
                        </ul>
                    </div>
                </div>

                <div class="timeline-item">
                    <h4>6月1日の処理（初期在庫読込後の最初の日次処理）</h4>
                    <div class="command-block">
<span class="comment"># 6月1日の伝票データインポート（マスタファイルも同時にインポートされます）</span>
<span class="command-line">dotnet run import-folder DeptA 2025-06-01</span>

<span class="comment"># アンマッチリスト作成（在庫マスタ更新）※全期間対象</span>
<span class="command-line">dotnet run unmatch-list</span>

<span class="comment"># 商品日報作成（開発用 - 推奨）</span>
<span class="command-line">.\dev.ps1 dev-daily-report 2025-06-01</span>

<span class="comment"># 在庫表作成（必要に応じて）</span>
<span class="command-line">dotnet run inventory-list 2025-06-01</span>

<span class="comment"># 日次終了処理の事前確認</span>
<span class="command-line">.\dev.ps1 dev-check-daily-close 2025-06-01</span>

<span class="comment"># 日次終了処理（在庫繰り越し）※重要</span>
<span class="command-line">.\dev.ps1 dev-daily-close 2025-06-01</span>
                    </div>
                    <div class="warning" style="margin-top: 15px;">
                        <strong>⚠️ 重要：日次終了処理について</strong>
                        <ul>
                            <li>日次終了処理により、当日の在庫が翌日の前日在庫として設定されます</li>
                            <li>この処理を行わないと、翌日のアンマッチが大量に発生します</li>
                            <li><strong>コマンド：</strong> <code>dev-daily-close</code>（開発用、時間制約なし）</li>
                            <li><strong>事前確認：</strong> <code>dev-check-daily-close</code>で実行可能か確認可能</li>
                            <li><strong>オプション：</strong> <code>--skip-validation</code>でデータチェックをスキップ</li>
                            <li>本番環境では15:00以降に実行（開発環境では時間制約なし）</li>
                        </ul>
                    </div>
                </div>

                <div class="timeline-item">
                    <h4>6月2日以降の処理</h4>
                    <div class="command-block">
<span class="comment"># 6月2日の処理（開発環境）</span>
<span class="command-line">dotnet run import-folder DeptA 2025-06-02</span>
<span class="command-line">dotnet run unmatch-list</span>
<span class="command-line">.\dev.ps1 dev-daily-report 2025-06-02</span>
<span class="command-line">.\dev.ps1 dev-daily-close 2025-06-02</span>

<span class="comment"># 6月3日の処理</span>
<span class="command-line">dotnet run import-folder DeptA 2025-06-03</span>
<span class="command-line">dotnet run unmatch-list</span>
<span class="command-line">.\dev.ps1 dev-daily-report 2025-06-03</span>
<span class="command-line">.\dev.ps1 dev-daily-close 2025-06-03</span>
                    </div>
                </div>

                <div class="timeline-item">
                    <h4>継続処理</h4>
                    <p><strong>必要な日付まで上記の手順を継続してください。</strong></p>
                    <p>最大で6月27日まで処理可能です。</p>
                </div>
            </div>
        </div>

        <div class="troubleshooting">
            <h3>🛠️ よくある問題と対処法</h3>

            <h4>❌ 問題1: 移行用在庫マスタの読込エラー</h4>
            <div class="step">
                <strong>原因:</strong> ZAIK*.csvファイルが見つからない、または形式が正しくない
                <div class="command-block">
<span class="comment"># 対処法1: ファイル存在確認</span>
<span class="command-line">dir D:\InventoryImport\DeptA\Import\ZAIK*.csv</span>

<span class="comment"># 対処法2: ファイル名確認（正しい形式: ZAIK20250531.csv）</span>
<span class="command-line">dotnet run import-initial-inventory DeptA</span>
                </div>
            </div>

            <h4>❌ 問題2: 商品マスタ未登録エラー</h4>
            <div class="step">
                <strong>原因:</strong> 商品マスタがインポートされていない
                <div class="command-block">
<span class="comment"># 対処法: マスタデータを先にインポート</span>
<span class="command-line">dotnet run import-folder DeptA  # マスタファイルのみインポート</span>

<span class="comment"># 商品マスタ確認</span>
<span class="command-line">dotnet run check-masters</span>
                </div>
            </div>

            <h4>❌ 問題3: PersonInChargeCodeやAveragePriceが設定されない</h4>
            <div class="step">
                <strong>原因:</strong> CSVファイルの列構成が正しくない
                <div class="command-block">
<span class="comment"># 対処法: CSVファイルの内容確認</span>
<span class="comment"># PersonInChargeCode（担当者コード）</span>
<span class="comment"># AveragePrice（平均単価）</span>
<span class="comment"># が正しい列に設定されているか確認</span>
                </div>
            </div>

            <h4>❌ 問題4: 翌日のアンマッチが大量発生</h4>
            <div class="step">
                <strong>原因:</strong> 前日の日次終了処理（在庫繰り越し）未実行
                <div class="command-block">
<span class="comment"># 対処法1: 前日の日次終了処理を実行</span>
<span class="command-line">.\dev.ps1 dev-daily-close 2025-06-01  # 前日分を実行</span>

<span class="comment"># その後、当日の処理を再実行</span>
<span class="command-line">dotnet run unmatch-list</span>
                </div>
            </div>

            <h4>❌ 問題5: import-initial-inventoryで重複エラー</h4>
            <div class="step">
                <strong>原因:</strong> 既に初期在庫データが存在する
                <div class="command-block">
<span class="comment"># 対処法: 既存データは自動的に無効化されます</span>
<span class="comment"># 重複実行しても安全です</span>
<span class="command-line">dotnet run import-initial-inventory DeptA</span>

<span class="comment"># 最新の初期在庫データのみがアクティブになります</span>
                </div>
            </div>
        </div>

        <div class="verification">
            <h3>🔍 検証ポイント</h3>
            
            <h4>1. 移行用在庫マスタの確認</h4>
            <table>
                <thead>
                    <tr>
                        <th>確認項目</th>
                        <th>SQLクエリ例</th>
                        <th>期待値</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>初期在庫件数</td>
                        <td>SELECT COUNT(*) FROM InventoryMaster WHERE ImportType = 'INITIAL' AND IsActive = 1</td>
                        <td>1,500件程度</td>
                    </tr>
                    <tr>
                        <td>PersonInChargeCode設定</td>
                        <td>SELECT COUNT(*) FROM InventoryMaster WHERE PersonInChargeCode > 0</td>
                        <td>設定済み件数</td>
                    </tr>
                    <tr>
                        <td>AveragePrice設定</td>
                        <td>SELECT COUNT(*) FROM InventoryMaster WHERE AveragePrice > 0</td>
                        <td>設定済み件数</td>
                    </tr>
                </tbody>
            </table>

            <h4>2. データ継続性の確認</h4>
            <div class="command-block">
<span class="comment">-- 在庫継続性確認（SQL Server Management Studioで実行）</span>
<span class="command-line">SELECT TOP 10</span>
<span class="command-line">    ProductCode, GradeCode,</span>
<span class="command-line">    PreviousMonthQuantity,  -- 前月末在庫数量</span>
<span class="command-line">    CurrentStock,          -- 当日在庫数量</span>
<span class="command-line">    PersonInChargeCode,    -- 担当者コード</span>
<span class="command-line">    AveragePrice          -- 平均単価</span>
<span class="command-line">FROM InventoryMaster</span>
<span class="command-line">WHERE ImportType = 'INITIAL' AND IsActive = 1</span>
<span class="command-line">ORDER BY JobDate DESC</span>
            </div>
        </div>

        <div class="phase">
            <div class="phase-header">
                <div class="phase-number">✓</div>
                <div class="phase-title">シミュレーション完了チェックリスト</div>
            </div>

            <div class="step">
                <h4>□ 環境準備完了</h4>
                <ul>
                    <li>□ データベース初期化済み</li>
                    <li>□ 接続確認済み</li>
                </ul>
            </div>

            <div class="step">
                <h4>□ 移行用在庫マスタ設定完了</h4>
                <ul>
                    <li>□ ZAIK*.csvファイルの配置済み</li>
                    <li>□ import-initial-inventoryコマンドで読込済み</li>
                    <li>□ 在庫マスタに初期在庫が設定済み</li>
                    <li>□ PersonInChargeCodeとAveragePriceが設定済み</li>
                    <li>□ SQLで初期在庫データ確認済み</li>
                </ul>
            </div>

            <div class="step">
                <h4>□ 日次処理動作確認完了</h4>
                <ul>
                    <li>□ マスタデータインポート済み（初回のimport-folderで自動インポート）</li>
                    <li>□ 商品マスタ登録確認済み（ProductMasterテーブルにデータあり）</li>
                    <li>□ 6月1日〜3日の連続処理確認済み</li>
                    <li>□ アンマッチリスト正常生成</li>
                    <li>□ 商品日報正常生成</li>
                    <li>□ 在庫表正常生成</li>
                    <li>□ 日次終了処理による在庫繰り越し確認済み</li>
                </ul>
            </div>

            <div class="step">
                <h4>□ 拡張テスト完了</h4>
                <ul>
                    <li>□ 1週間分の連続処理確認済み</li>
                    <li>□ パフォーマンス測定済み</li>
                    <li>□ エラーハンドリング確認済み</li>
                    <li>□ 移行用在庫マスタの重複実行テスト済み</li>
                </ul>
            </div>
        </div>

        <!-- Phase 4: 実行例 -->
        <div class="phase">
            <div class="phase-header">
                <div class="phase-number">🚀</div>
                <div class="phase-title">実行例（移行用在庫マスタ → 6月1日〜3日）</div>
            </div>
            
            <div class="info" style="margin-bottom: 20px;">
                <h4>🆕 新しい運用フロー（移行用在庫マスタ対応）</h4>
                <p>移行用在庫マスタ（ZAIK*.csv）の読込から日次処理まで、シンプルで統一されたコマンドで処理できます。</p>
                <table style="margin: 15px 0;">
                    <thead>
                        <tr>
                            <th>段階</th>
                            <th>コマンド</th>
                            <th>用途</th>
                            <th>実行頻度</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>初期設定</td>
                            <td>import-initial-inventory</td>
                            <td>移行用在庫マスタ読込</td>
                            <td>システム開始時のみ</td>
                        </tr>
                        <tr>
                            <td>日次処理</td>
                            <td>import-folder</td>
                            <td>伝票データ取込・自動引継</td>
                            <td>毎日</td>
                        </tr>
                        <tr>
                            <td>帳票出力</td>
                            <td>unmatch-list, daily-report</td>
                            <td>アンマッチリスト・商品日報</td>
                            <td>毎日</td>
                        </tr>
                        <tr>
                            <td>在庫繰越</td>
                            <td>daily-close</td>
                            <td>翌日への在庫引継</td>
                            <td>毎日</td>
                        </tr>
                    </tbody>
                </table>
            </div>
            
            <div class="example-section">
                <h4>📅 Step 0: 移行用在庫マスタ読込（システム開始時のみ）</h4>
                <div class="step" style="background: rgba(52, 152, 219, 0.1); padding: 15px; border-radius: 5px; margin-bottom: 20px;">
                    <h5 style="color: #3498db;">移行用在庫マスタの準備と読込</h5>
                    <div class="command-block">
<span class="comment"># 1. ZAIK*.csvファイルを配置</span>
<span class="command-line">copy ZAIK20250531.csv D:\InventoryImport\DeptA\Import\</span>

<span class="comment"># 2. 移行用在庫マスタ読込</span>
<span class="command-line">dotnet run import-initial-inventory DeptA</span>

<span class="comment"># 3. 読込結果確認</span>
<span class="command-line">dotnet run check-data-status</span>
                    </div>
                    <div class="success" style="margin-top: 10px;">
                        <strong>実際のログ出力例：</strong>
                        <pre style="background: #f5f5f5; padding: 10px; border-radius: 5px;">
=== 初期在庫インポートコマンド開始 ===
対象ファイル: ZAIK20250531.csv
推定日付: 2025-05-31
DataSetId: INITIAL_20250531_090000
読み込み完了 - 有効: 1234件, エラー: 0件
変換完了 - 成功: 1234件, エラー: 0件
データベース登録完了: 1234件処理
=== 初期在庫インポートコマンド完了 ===</pre>
                    </div>
                </div>
                
                <h4>📅 Step 1: 6月1日（土曜日）- 伝票データなしの自動処理</h4>
                <div class="step" style="background: rgba(255, 255, 255, 0.05); padding: 15px; border-radius: 5px; margin-bottom: 20px;">
                    <h5 style="color: #e74c3c;">実行コマンド（移行用在庫マスタ読込後の最初の日次処理）</h5>
                    <div class="command-block">
<span class="comment"># 1. import-folderが自動的に処理モードを判断</span>
<span class="command-line">dotnet run import-folder DeptA 2025-06-01</span>

<span class="comment"># 2. アンマッチリスト作成</span>
<span class="command-line">dotnet run unmatch-list</span>

<span class="comment"># 3. 商品日報作成</span>
<span class="command-line">.\dev.ps1 dev-daily-report 2025-06-01</span>

<span class="comment"># 4. 日次終了処理</span>
<span class="command-line">.\dev.ps1 dev-daily-close 2025-06-01</span>
                    </div>
                </div>
                
                <h4>📅 Step 2以降: 継続的な日次処理</h4>
                <div class="success">
                    <p><strong>✨ ポイント：毎日同じ4つのコマンドを実行するだけ</strong></p>
                    <div class="command-block">
<span class="comment"># PowerShellスクリプトで一括実行（推奨）</span>
<span class="command-line">$dates = @("2025-06-02", "2025-06-03", "2025-06-04")</span>
<span class="command-line">foreach ($date in $dates) {</span>
<span class="command-line">    Write-Host "=== $date の処理開始 ===" -ForegroundColor Cyan</span>
<span class="command-line">    dotnet run import-folder DeptA $date</span>
<span class="command-line">    dotnet run unmatch-list</span>
<span class="command-line">    .\dev.ps1 dev-daily-report $date</span>
<span class="command-line">    .\dev.ps1 dev-daily-close $date</span>
<span class="command-line">    Write-Host "=== $date の処理完了 ===" -ForegroundColor Green</span>
<span class="command-line">}</span>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Important Points -->
        <div class="phase">
            <div class="phase-header">
                <div class="phase-number">💡</div>
                <div class="phase-title">重要なポイント</div>
            </div>
            
            <div class="info">
                <ul>
                    <li><strong>移行用在庫マスタの重要性</strong>: import-initial-inventoryで正確な初期在庫を設定することが、その後の全処理の基盤となります</li>
                    <li><strong>PersonInChargeCodeとAveragePrice</strong>: 移行用在庫マスタから担当者コードと平均単価も自動設定されます</li>
                    <li><strong>統一されたコマンド</strong>: import-folderコマンドが自動的に伝票の有無を判定し、適切な処理モードを選択します</li>
                    <li><strong>シンプルな運用</strong>: 
                        <ul>
                            <li>初期設定：import-initial-inventory（1回のみ）</li>
                            <li>日次処理：毎日同じ4つのコマンドを実行</li>
                            <li>伝票の有無を事前に確認する必要なし</li>
                        </ul>
                    </li>
                    <li><strong>安全性</strong>: 移行用在庫マスタは重複実行しても安全（既存データは自動無効化）</li>
                    <li><strong>日次終了処理の重要性</strong>: 伝票の有無に関わらず、必ず日次終了処理を実行して在庫を繰り越してください</li>
                </ul>
            </div>
        </div>
        
        <!-- Caution Section -->
        <div class="phase" style="background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%); color: white;">
            <div class="phase-header">
                <div class="phase-number" style="background: white; color: #e74c3c;">🚨</div>
                <div class="phase-title" style="color: white;">注意事項</div>
            </div>
            
            <div class="warning" style="background: rgba(255, 255, 255, 0.2); border: 1px solid rgba(255, 255, 255, 0.3);">
                <h4 style="color: white;">❌ やってはいけないこと</h4>
                <ul style="color: white;">
                    <li>import-initial-inventoryを実行せずに6月1日の処理を開始する</li>
                    <li>前月末在庫.csvを使用する（廃止済み）</li>
                    <li>日付を飛ばして処理する（例：6/1の次に6/3を処理）</li>
                    <li>同じ日付で複数回import-folderを実行する（重複データの原因）</li>
                    <li>日次終了処理をスキップする（翌日のアンマッチ大量発生の原因）</li>
                </ul>
                
                <h4 style="color: white;">✅ 推奨される運用</h4>
                <ul style="color: white;">
                    <li>システム開始時：import-initial-inventoryで移行用在庫マスタを読込</li>
                    <li>毎日定時に同じ4つのコマンドを実行（import-folder → unmatch-list → daily-report → daily-close）</li>
                    <li>処理漏れがあった場合は、漏れた日から順番に処理</li>
                    <li>伝票の有無は意識せず、import-folderの自動判定に任せる</li>
                    <li>移行用在庫マスタは重複実行しても安全（必要に応じて再実行可能）</li>
                </ul>
            </div>
        </div>

        <!-- 全コマンド一覧セクション -->
        <div class="phase">
            <div class="phase-header">
                <div class="phase-number">📋</div>
                <div class="phase-title">在庫管理システム全コマンド一覧</div>
            </div>
            
            <div class="info">
                <h4>📝 利用可能なコマンド（Program.cs より抽出）</h4>
                <p>以下は実際にシステムで利用可能な全コマンドです。</p>
            </div>

            <table>
                <thead>
                    <tr>
                        <th>分類</th>
                        <th>コマンド</th>
                        <th>説明</th>
                        <th>パラメータ例</th>
                    </tr>
                </thead>
                <tbody>
                    <tr style="background: #e8f5e8;">
                        <td rowspan="4"><strong>テスト・接続確認</strong></td>
                        <td>test-connection</td>
                        <td>データベース接続テスト</td>
                        <td>-</td>
                    </tr>
                    <tr style="background: #e8f5e8;">
                        <td>test-fastreport</td>
                        <td>FastReportテスト（DB不要）</td>
                        <td>-</td>
                    </tr>
                    <tr style="background: #e8f5e8;">
                        <td>test-pdf</td>
                        <td>PDF生成テスト（廃止済み）</td>
                        <td>test-fastreportを使用</td>
                    </tr>
                    <tr style="background: #e8f5e8;">
                        <td>debug-csv-structure</td>
                        <td>CSV構造デバッグ</td>
                        <td>[CSVファイルパス]</td>
                    </tr>
                    <tr style="background: #e8f4f8;">
                        <td rowspan="6"><strong>データベース管理</strong></td>
                        <td>init-database</td>
                        <td>データベース初期化</td>
                        <td>[--force]</td>
                    </tr>
                    <tr style="background: #e8f4f8;">
                        <td>check-data-status</td>
                        <td>データ状態確認</td>
                        <td>[YYYY-MM-DD]</td>
                    </tr>
                    <tr style="background: #e8f4f8;">
                        <td>check-schema</td>
                        <td>スキーマ確認</td>
                        <td>[YYYY-MM-DD]</td>
                    </tr>
                    <tr style="background: #e8f4f8;">
                        <td>migrate-phase2</td>
                        <td>フェーズ2マイグレーション</td>
                        <td>[YYYY-MM-DD]</td>
                    </tr>
                    <tr style="background: #e8f4f8;">
                        <td>migrate-phase3</td>
                        <td>フェーズ3マイグレーション</td>
                        <td>[YYYY-MM-DD]</td>
                    </tr>
                    <tr style="background: #e8f4f8;">
                        <td>migrate-phase5</td>
                        <td>フェーズ5マイグレーション</td>
                        <td>[YYYY-MM-DD]</td>
                    </tr>
                    <tr style="background: #fff3e0;">
                        <td rowspan="9"><strong>データインポート</strong></td>
                        <td>import-folder</td>
                        <td>フォルダからCSV一括インポート（推奨）</td>
                        <td>DeptA [YYYY-MM-DD]</td>
                    </tr>
                    <tr style="background: #fff3e0;">
                        <td>import-initial-inventory</td>
                        <td>移行用在庫マスタ読込（ZAIK*.csv）</td>
                        <td>DeptA</td>
                    </tr>
                    <tr style="background: #fff3e0;">
                        <td>import-sales</td>
                        <td>売上伝票インポート（単体）</td>
                        <td>[ファイルパス] [YYYY-MM-DD]</td>
                    </tr>
                    <tr style="background: #fff3e0;">
                        <td>import-purchase</td>
                        <td>仕入伝票インポート（単体）</td>
                        <td>[ファイルパス] [YYYY-MM-DD]</td>
                    </tr>
                    <tr style="background: #fff3e0;">
                        <td>import-adjustment</td>
                        <td>在庫調整インポート（単体）</td>
                        <td>[ファイルパス] [YYYY-MM-DD]</td>
                    </tr>
                    <tr style="background: #fff3e0;">
                        <td>import-customers</td>
                        <td>得意先マスタインポート</td>
                        <td>[ファイルパス]</td>
                    </tr>
                    <tr style="background: #fff3e0;">
                        <td>import-products</td>
                        <td>商品マスタインポート</td>
                        <td>[ファイルパス]</td>
                    </tr>
                    <tr style="background: #fff3e0;">
                        <td>import-suppliers</td>
                        <td>仕入先マスタインポート</td>
                        <td>[ファイルパス]</td>
                    </tr>
                    <tr style="background: #fff3e0;">
                        <td>import-masters</td>
                        <td>マスタデータ一括インポート</td>
                        <td>-</td>
                    </tr>
                    <tr style="background: #e3f2fd;">
                        <td rowspan="3"><strong>帳票出力</strong></td>
                        <td>unmatch-list</td>
                        <td>アンマッチリスト作成</td>
                        <td>-（全期間対象）</td>
                    </tr>
                    <tr style="background: #e3f2fd;">
                        <td>daily-report</td>
                        <td>商品日報作成</td>
                        <td>[YYYY-MM-DD] [--dataset-id ID]</td>
                    </tr>
                    <tr style="background: #e3f2fd;">
                        <td>inventory-list</td>
                        <td>在庫表作成</td>
                        <td>[YYYY-MM-DD]</td>
                    </tr>
                    <tr style="background: #f3e5f5;">
                        <td rowspan="4"><strong>日次終了処理</strong></td>
                        <td>check-daily-close</td>
                        <td>日次終了処理の事前確認</td>
                        <td>[YYYY-MM-DD]</td>
                    </tr>
                    <tr style="background: #f3e5f5;">
                        <td>dev-check-daily-close</td>
                        <td>日次終了処理の事前確認（開発用）</td>
                        <td>[YYYY-MM-DD]</td>
                    </tr>
                    <tr style="background: #f3e5f5;">
                        <td>dev-daily-close</td>
                        <td>日次終了処理実行（開発用）</td>
                        <td>[YYYY-MM-DD]</td>
                    </tr>
                    <tr style="background: #f3e5f5;">
                        <td>reset-daily-close</td>
                        <td>日次終了処理リセット</td>
                        <td>[YYYY-MM-DD]</td>
                    </tr>
                    <tr style="background: #fce4ec;">
                        <td rowspan="8"><strong>在庫管理</strong></td>
                        <td>init-inventory</td>
                        <td>在庫初期化</td>
                        <td>[YYYY-MM-DD]</td>
                    </tr>
                    <tr style="background: #fce4ec;">
                        <td>optimize-inventory</td>
                        <td>在庫最適化</td>
                        <td>[YYYY-MM-DD]</td>
                    </tr>
                    <tr style="background: #fce4ec;">
                        <td>import-previous-inventory</td>
                        <td>前月末在庫インポート</td>
                        <td>[ファイルパス] [YYYY-MM-DD]</td>
                    </tr>
                    <tr style="background: #fce4ec;">
                        <td>import-with-carryover</td>
                        <td>前日在庫引継でインポート</td>
                        <td>[YYYY-MM-DD]</td>
                    </tr>
                    <tr style="background: #fce4ec;">
                        <td>create-cp-inventory</td>
                        <td>コピー在庫作成</td>
                        <td>[YYYY-MM-DD]</td>
                    </tr>
                    <tr style="background: #fce4ec;">
                        <td>cleanup-inventory-duplicates</td>
                        <td>在庫重複データクリーンアップ</td>
                        <td>-</td>
                    </tr>
                    <tr style="background: #fce4ec;">
                        <td>init-monthly-inventory</td>
                        <td>月次在庫初期化</td>
                        <td>[YYYY-MM-DD]</td>
                    </tr>
                    <tr style="background: #fce4ec;">
                        <td>simulate-daily</td>
                        <td>日次処理シミュレーション</td>
                        <td>[YYYY-MM-DD]</td>
                    </tr>
                    <tr style="background: #f1f8e9;">
                        <td rowspan="3"><strong>開発・メンテナンス</strong></td>
                        <td>dev-daily-report</td>
                        <td>商品日報作成（開発用）</td>
                        <td>[YYYY-MM-DD]</td>
                    </tr>
                    <tr style="background: #f1f8e9;">
                        <td>check-masters</td>
                        <td>マスタデータ確認</td>
                        <td>-</td>
                    </tr>
                    <tr style="background: #f1f8e9;">
                        <td>init-folders</td>
                        <td>フォルダ初期化</td>
                        <td>-</td>
                    </tr>
                </tbody>
            </table>

            <div class="warning">
                <h4>⚠️ 重要なコマンド使用上の注意</h4>
                <ul>
                    <li><strong>dev-*コマンド</strong>：開発用コマンドで時間制約がありません</li>
                    <li><strong>import-folder</strong>：推奨のインポートコマンド（自動引継機能あり）</li>
                    <li><strong>unmatch-list</strong>：日付パラメータ不要（全期間対象）</li>
                    <li><strong>test-pdf</strong>：廃止済み、test-fastreportを使用してください</li>
                    <li><strong>check-inventory-status</strong>：存在しません、check-data-statusを使用してください</li>
                </ul>
            </div>

            <div class="step">
                <h4>💡 推奨コマンド組み合わせ（日次処理）</h4>
                <div class="command-block">
<span class="comment"># 基本的な日次処理フロー</span>
<span class="command-line">dotnet run import-folder DeptA 2025-06-01</span>
<span class="command-line">dotnet run unmatch-list</span>
<span class="command-line">.\dev.ps1 dev-daily-report 2025-06-01</span>
<span class="command-line">.\dev.ps1 dev-daily-close 2025-06-01</span>

<span class="comment"># 初期設定（システム開始時のみ）</span>
<span class="command-line">dotnet run import-initial-inventory DeptA</span>
<span class="command-line">dotnet run check-data-status</span>
                </div>
            </div>
        </div>

        <div class="header" style="margin-top: 50px; background: rgba(255, 255, 255, 0.95); padding: 20px; border-radius: 10px;">
            <p><strong>🎯 この手順により、移行用在庫マスタを基盤とした安全で確実な在庫管理が実現できます</strong></p>
            <p>import-initial-inventoryによる初期設定から日次処理まで、段階的に進めることで確実な運用が可能です</p>
            <br>
            <button class="button" onclick="window.print()">📄 この手順書を印刷</button>
        </div>
    </div>

    <script>
        // ページ読み込み時のアニメーション
        window.addEventListener('load', function() {
            const phases = document.querySelectorAll('.phase');
            phases.forEach((phase, index) => {
                setTimeout(() => {
                    phase.style.opacity = '0';
                    phase.style.transform = 'translateY(20px)';
                    phase.style.transition = 'all 0.6s ease';
                    
                    setTimeout(() => {
                        phase.style.opacity = '1';
                        phase.style.transform = 'translateY(0)';
                    }, 100);
                }, index * 200);
            });
        });

        // コマンドブロックのクリックでコピー機能
        document.querySelectorAll('.command-block').forEach(block => {
            block.addEventListener('click', function() {
                const text = this.textContent.replace(/PowerShell \(Click to Copy\)/g, '').trim();
                navigator.clipboard.writeText(text).then(() => {
                    const originalBg = this.style.background;
                    this.style.background = '#2ecc71';
                    setTimeout(() => {
                        this.style.background = originalBg;
                    }, 500);
                });
            });
        });
    </script>
</body>
</html>