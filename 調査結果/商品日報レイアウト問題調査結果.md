# 商品日報レイアウト問題調査結果（修正版）

**調査日時**: 2025年7月5日  
**調査対象**: DailyReport_20250630_094227.pdf  
**調査方法**: PDF実物の詳細確認

## 1. 実際のレイアウト構造

### 1.1 ヘッダー構造（3段構成）

#### 第1段（ページヘッダー）
- **左上**: 作成日：202Y年99月99日99時9分99秒
- **中央**: ※　202Y年99月99日　商　品　日　報　※
- **右上**: ZZZ9 頁

#### 第2段（大見出し）
- **日計**: `<- - - - - - - - - - - - - - - - - 日　　　　　　計 - - - - - - - - - - - - - - - - - - - - - >`
- **月計**: `<- - - - - - - - - - - 月　　　　計 - - - - - - - - - - - - - - - >`
- 横長の破線で囲まれた枠として表示（縦の区切り線はない）

#### 第3段（項目見出し）
- **商品名**は通常の1行分の高さ（セル結合なし）
- 各項目は空白で区切られている（縦線なし）

### 1.2 実際のヘッダー構造

```
作成日：202Y年99月99日99時9分99秒            ※　202Y年99月99日　商　品　日　報　※                   ZZZ9 頁
<- - - - - - - - - - - - - - - - - 日　　　　　　計 - - - - - - - - - - - - - - - - - - - - - > <- - - - - - - - - - - 月　　　　計 - - - - - - - - - - - - - - - >
商　品　名 売上数量 売上金額 仕入値引 在庫調整 　加工費 　振　替 　奨励金 １粗利益 １粗利率 ２粗利益 ２粗利率 売上金額 １粗利益 １粗利率 ２粗利益 ２粗利率
```

## 2. データ行の特徴

### 2.1 商品明細行
- **商品名**: 「商品名商品名商品」（全角17文字幅）
- **数値フォーマット**: 
  - 数量・金額：`ZZ,ZZ9.99-`（カンマ区切り、小数2桁、末尾マイナス）
  - 率：`ZZ9.99-%`（パーセント記号付き）
  - 一部に`▲`記号（マイナス値の特殊表記）

### 2.2 集計行
- **大分類計**: `＊　大分類計　＊`（両端に全角アスタリスク）
- **合計**: `※　合　　計　※`（両端に全角※記号）

## 3. 現在の実装における推定問題点

### 3.1 大見出しの実装問題
- 日計・月計の破線枠が正しく表現されていない可能性
- 破線は横長の装飾的な枠として実装する必要がある

### 3.2 文字間隔の問題
- 商品名の「商　品　名」のように全角スペースが含まれている
- 「日　　　　　　計」「月　　　　計」の文字間隔が広い
- 「　加工費」「　振　替」など、先頭に全角スペースがある項目

### 3.3 数値フォーマットの実装
- `▲`記号の出力条件が不明確
- 小数点以下の桁数制御
- ゼロサプレス（先頭のゼロを空白に）の実装

## 4. FastReportテンプレートで確認すべき項目

### 4.1 バンド構成
1. **PageHeaderBand**：3段構成を適切に収容できる高さ
2. **DataBand**：商品明細行
3. **GroupFooterBand**：大分類計の表示（存在する場合）
4. **ReportSummaryBand**：合計行

### 4.2 オブジェクト配置
1. **破線枠の実装方法**
   - TextObjectのBorderプロパティ
   - またはLineObjectによる描画
2. **文字間隔の制御**
   - 全角スペースの挿入位置
   - TextObjectのHorzAlignプロパティ

### 4.3 数値フォーマット
1. **Format文字列の設定**
   - 数値：`#,##0.00;#,##0.00-`
   - 率：`#0.00%;#0.00-%`
2. **▲記号の条件付き表示**
   - 特定の条件での文字列置換が必要

## 5. 推奨される修正アプローチ

### 5.1 短期的修正（現在の構造を維持）
1. 大見出しの破線枠を正しく実装
2. 文字間隔を仕様通りに調整
3. 数値フォーマットの修正

### 5.2 長期的改善（構造の見直し）
1. TableObjectの使用検討（現在は個別のTextObject）
2. スタイルシートの導入による一貫性確保
3. マスターページの活用

## 6. 検証ポイント

### 6.1 レイアウト検証
- [ ] 3段構成のヘッダーが正しく表示されるか
- [ ] 破線枠が適切に描画されるか
- [ ] 文字間隔が仕様通りか
- [ ] 列の配置が均等か

### 6.2 データ検証
- [ ] 数値フォーマットが正しいか
- [ ] ▲記号が適切に表示されるか
- [ ] 大分類計・合計行が正しく出力されるか
- [ ] ページ番号が正しく採番されるか

---

**注記**: この調査結果はPDF実物の確認に基づいています。FastReportテンプレートの実装詳細と照合して、具体的な修正方針を決定する必要があります。