# ã‚¢ãƒ³ãƒžãƒƒãƒãƒªã‚¹ãƒˆåœ¨åº«0åˆ¤å®šãƒ­ã‚¸ãƒƒã‚¯ã‚¨ãƒ©ãƒ¼èª¿æŸ»å ±å‘Š

**èª¿æŸ»æ—¥æ™‚**: 2025å¹´7æœˆ26æ—¥  
**èª¿æŸ»å¯¾è±¡**: åœ¨åº«0ã‚¢ãƒ©ãƒ¼ãƒˆã®åˆ¤å®šãƒ­ã‚¸ãƒƒã‚¯  
**å•é¡Œ**: åŒæ—¥å£²ä¸Šãƒ»ä»•å…¥ç›¸æ®ºã«ã‚ˆã‚‹èª¤ã£ãŸåœ¨åº«0ã‚¢ãƒ©ãƒ¼ãƒˆç™ºç”Ÿ  

## ðŸš¨ é‡å¤§ãªãƒ­ã‚¸ãƒƒã‚¯ã‚¨ãƒ©ãƒ¼ã®ç™ºè¦‹

### ç¾åœ¨ã®èª¤ã£ãŸå®Ÿè£…ï¼ˆUnmatchListService.cs:470è¡Œç›®ï¼‰

```csharp
else if (cpInventory.PreviousDayStock >= 0 && cpInventory.DailyStock <= 0)
{
    stockZeroCount++;
    // åœ¨åº«0ä»¥ä¸‹ã‚¨ãƒ©ãƒ¼ï¼ˆãƒžã‚¤ãƒŠã‚¹åœ¨åº«å«ã‚€ï¼‰
    var unmatchItem = UnmatchItem.FromSalesVoucher(sales, "åœ¨åº«0",
        cpInventory.GetAdjustedProductCategory1());
    unmatchItems.Add(unmatchItem);
}
```

### å•é¡Œã®è©³ç´°åˆ†æž

#### âŒ ç¾åœ¨ã®èª¤ã£ãŸåˆ¤å®šæ¡ä»¶
- **æ¡ä»¶**: `PreviousDayStock >= 0 && DailyStock <= 0`
- **å•é¡Œ**: åŒæ—¥ã®æ­£å¸¸ãªå£²ä¸Šãƒ»ä»•å…¥å–å¼•ã«ã‚ˆã‚‹ç›¸æ®ºã‚’ã‚¨ãƒ©ãƒ¼ã¨ã—ã¦æ‰±ã£ã¦ã„ã‚‹

#### ðŸ” å…·ä½“çš„ãªå•é¡Œã‚±ãƒ¼ã‚¹ï¼ˆå•†å“01703ã®ä¾‹ï¼‰

**ãƒ‡ãƒ¼ã‚¿çŠ¶æ³**:
```
å‰æ—¥åœ¨åº«: 22.0000
å½“æ—¥ä»•å…¥: +121.0000  (11:ä»•å…¥ä¼ç¥¨ 4.0000 + 7.0000 = 11.0000)
å½“æ—¥å£²ä¸Š: -121.0000  (51:å£²ä¸Šä¼ç¥¨ 8ä»¶ = 11.0000)
çµæžœ: DailyStock = 22.0000 + 11.0000 - 11.0000 = 22.0000
```

**ã—ã‹ã—å®Ÿéš›ã®CSVãƒ‡ãƒ¼ã‚¿ã§ã¯**:
- è·å°å‰æ—¥åœ¨åº«æ•°: 22
- å½“æ—¥åœ¨åº«æ•°: 24, 23, 25, 18, 15 (å£²ä¸Šç™ºç”Ÿå¾Œã®æ®‹åœ¨åº«)
- æœ€çµ‚åˆ¤å®š: OK (æ­£å¸¸)

#### ðŸ“Š ãƒ‡ãƒ¼ã‚¿è¨¼æ‹ 

**ã‚¯ã‚¨ãƒªï¼’/ï¼’.csvåˆ†æžçµæžœ**:
```csv
"ä¼ç¥¨ç¨®é¡ž","å•†å“ã‚³ãƒ¼ãƒ‰","ç­‰ç´šã‚³ãƒ¼ãƒ‰","éšŽç´šã‚³ãƒ¼ãƒ‰","è·å°ã‚³ãƒ¼ãƒ‰","è·å°å","æ•°é‡","é‡‘é¡","5é …ç›®ã‚­ãƒ¼","é™¤å¤–åˆ¤å®š","åœ¨åº«ãƒžã‚¹ã‚¿å­˜åœ¨","è·å°å‰æ—¥åœ¨åº«æ•°","å½“æ—¥åœ¨åº«æ•°","ã‚¢ãƒ³ãƒžãƒƒãƒç¨®åˆ¥","æœ€çµ‚åˆ¤å®š","5æœˆæœ«åœ¨åº«æ•°é‡","åœ¨åº«ã¡ã‡ã£ã"

å£²ä¸Šä¼ç¥¨(51): 8ä»¶ - å‰æ—¥åœ¨åº«22ã‹ã‚‰é †æ¬¡æ¸›å°‘: 24â†’23â†’25â†’23â†’23â†’23â†’23
ä»•å…¥ä¼ç¥¨(11): 2ä»¶ - ä»•å…¥ã«ã‚ˆã‚Šåœ¨åº«å¢—åŠ : 18â†’15
```

**é‡è¦ãªç™ºè¦‹**: ã™ã¹ã¦ã®å–å¼•ã§`æœ€çµ‚åˆ¤å®š: OK`ã¨ãªã£ã¦ãŠã‚Šã€åœ¨åº«0ã‚¢ãƒ©ãƒ¼ãƒˆã¯ç™ºç”Ÿã—ã¦ã„ãªã„

### ðŸŽ¯ æ­£ã—ã„åœ¨åº«0ã‚¢ãƒ©ãƒ¼ãƒˆã®å®šç¾©

#### âœ… æœ¬æ¥ãƒã‚§ãƒƒã‚¯ã™ã¹ãæ¡ä»¶

1. **åœ¨åº«ä¸è¶³ã«ã‚ˆã‚‹å£²ä¸Šä¸å¯èƒ½**:
   ```csharp
   // å£²ä¸Šæ™‚ç‚¹ã§åœ¨åº«ãŒä¸è¶³ã—ã¦ã„ã‚‹å ´åˆ
   if (å£²ä¸Šå‰ã®åœ¨åº«æ•°é‡ < å£²ä¸Šæ•°é‡)
   {
       // åœ¨åº«0ã‚¢ãƒ©ãƒ¼ãƒˆ
   }
   ```

2. **ãƒžã‚¤ãƒŠã‚¹åœ¨åº«ã®æ¤œå‡º**:
   ```csharp
   // å–å¼•å¾Œã«åœ¨åº«ãŒãƒžã‚¤ãƒŠã‚¹ã«ãªã‚‹å ´åˆ
   if (å–å¼•å¾Œåœ¨åº« < 0)
   {
       // åœ¨åº«0ã‚¢ãƒ©ãƒ¼ãƒˆï¼ˆãƒžã‚¤ãƒŠã‚¹åœ¨åº«ï¼‰
   }
   ```

#### âŒ ç¾åœ¨ã®èª¤ã£ãŸåˆ¤å®šãŒç”Ÿæˆã™ã‚‹å•é¡Œ

**ã‚·ãƒŠãƒªã‚ª**: å‰æ—¥åœ¨åº«20ã€å½“æ—¥ä»•å…¥10ã€å½“æ—¥å£²ä¸Š30
- å‰æ—¥åœ¨åº«: 20 (>= 0) âœ“
- å½“æ—¥åœ¨åº«: 20 + 10 - 30 = 0 (<= 0) âœ“
- **ç¾åœ¨ã®ãƒ­ã‚¸ãƒƒã‚¯**: "åœ¨åº«0"ã‚¢ãƒ©ãƒ¼ãƒˆç™ºç”Ÿ âŒ **é–“é•ã„**
- **æ­£ã—ã„åˆ¤å®š**: åœ¨åº«ã¯ååˆ†ã‚ã£ãŸãŒçµæžœçš„ã«0ã«ãªã£ãŸã ã‘ âœ… **æ­£å¸¸**

### ðŸ“ˆ å‡¦ç†é †åºã®å•é¡Œ

#### ç¾åœ¨ã®å‡¦ç†ãƒ•ãƒ­ãƒ¼ï¼ˆå•é¡Œã‚ã‚Šï¼‰
```
1. CPåœ¨åº«ãƒžã‚¹ã‚¿ä½œæˆï¼ˆå‰æ—¥åœ¨åº«ã®ã‚³ãƒ”ãƒ¼ï¼‰
2. å½“æ—¥å£²ä¸Šãƒ»ä»•å…¥ãƒ»èª¿æ•´ãƒ‡ãƒ¼ã‚¿ã®é›†è¨ˆ
3. DailyStockè¨ˆç®—ï¼ˆCalculateDailyStockAsyncï¼‰
4. ã‚¢ãƒ³ãƒžãƒƒãƒåˆ¤å®šï¼ˆDailyStock <= 0ã‚’ãƒã‚§ãƒƒã‚¯ï¼‰â† ã“ã“ãŒé–“é•ã„
```

#### æ­£ã—ã„å‡¦ç†ãƒ•ãƒ­ãƒ¼ï¼ˆã‚ã‚‹ã¹ãå§¿ï¼‰
```
1. CPåœ¨åº«ãƒžã‚¹ã‚¿ä½œæˆï¼ˆå‰æ—¥åœ¨åº«ã®ã‚³ãƒ”ãƒ¼ï¼‰
2. å„å–å¼•ã‚’æ™‚ç³»åˆ—é †ã«å‡¦ç†
3. å„å–å¼•æ™‚ç‚¹ã§ã®åœ¨åº«å……è¶³æ€§ã‚’ãƒã‚§ãƒƒã‚¯
4. ãƒžã‚¤ãƒŠã‚¹åœ¨åº«ã«ãªã‚‹å–å¼•ã‚’ã‚¢ãƒ©ãƒ¼ãƒˆå¯¾è±¡ã¨ã™ã‚‹
```

### ðŸ” æ ¹æœ¬åŽŸå› ã®ç‰¹å®š

#### å•é¡Œ1: æ™‚ç³»åˆ—ã‚’ç„¡è¦–ã—ãŸé›†è¨ˆãƒ™ãƒ¼ã‚¹åˆ¤å®š
- **ç¾çŠ¶**: 1æ—¥åˆ†ã®å–å¼•ã‚’é›†è¨ˆã—ã¦ã‹ã‚‰åˆ¤å®š
- **å•é¡Œ**: å–å¼•ç™ºç”Ÿæ™‚ç‚¹ã§ã®åœ¨åº«çŠ¶æ³ã‚’ç„¡è¦–
- **çµæžœ**: æ­£å¸¸ãªå–å¼•ã§ã‚‚çµæžœçš„ã«DailyStock=0ã«ãªã‚‹ã¨èª¤ã£ã¦ã‚¢ãƒ©ãƒ¼ãƒˆ

#### å•é¡Œ2: åœ¨åº«0ã®å®šç¾©ã®èª¤è§£
- **ç¾çŠ¶**: æœ€çµ‚çš„ã«DailyStock <= 0ã«ãªã‚‹ã“ã¨ã‚’å•é¡Œè¦–
- **æ­£ã—ã„å®šç¾©**: å–å¼•æ™‚ç‚¹ã§åœ¨åº«ãŒä¸è¶³ã—ã¦ã„ã‚‹ã“ã¨ãŒå•é¡Œ

#### å•é¡Œ3: å£²ä¸Šãƒ»ä»•å…¥ã®å‡¦ç†é †åºã‚’è€ƒæ…®ã—ãªã„è¨­è¨ˆ
- **å•é¡Œ**: å£²ä¸Šâ†’ä»•å…¥ã€ä»•å…¥â†’å£²ä¸Šã©ã¡ã‚‰ã®é †åºã§ã‚‚åŒã˜åˆ¤å®š
- **ç¾å®Ÿ**: å£²ä¸Šã¯åœ¨åº«ãŒã‚ã‚‹æ™‚ç‚¹ã§å®Ÿè¡Œã€ä»•å…¥ã¯åœ¨åº«ã‚’å¢—ã‚„ã™

### ðŸ“‹ ä¿®æ­£ãŒå¿…è¦ãªç®‡æ‰€

#### 1. UnmatchListService.cs (470è¡Œç›®)
```csharp
// âŒ ç¾åœ¨ã®èª¤ã£ãŸå®Ÿè£…
else if (cpInventory.PreviousDayStock >= 0 && cpInventory.DailyStock <= 0)

// âœ… ä¿®æ­£æ¡ˆï¼ˆè©³ç´°è¨­è¨ˆã¯åˆ¥é€”å¿…è¦ï¼‰
// å„å£²ä¸Šå–å¼•æ™‚ç‚¹ã§ã®åœ¨åº«å……è¶³æ€§ã‚’ãƒã‚§ãƒƒã‚¯ã™ã‚‹æ–°ã—ã„ãƒ­ã‚¸ãƒƒã‚¯ã«ç½®ãæ›ãˆ
```

#### 2. åŒæ§˜ã®å•é¡ŒãŒã‚ã‚‹ç®‡æ‰€
- **CheckPurchaseUnmatchAsync** (541è¡Œç›®): `cpInventory.DailyStock <= 0`
- **CheckInventoryAdjustmentUnmatchAsync** (663è¡Œç›®): `cpInventory.DailyStock <= 0`

### ðŸŽ¯ æŽ¨å¥¨ã•ã‚Œã‚‹ä¿®æ­£æ–¹é‡

#### ãƒ•ã‚§ãƒ¼ã‚º1: æ™‚ç³»åˆ—ãƒ™ãƒ¼ã‚¹åœ¨åº«ãƒã‚§ãƒƒã‚¯
1. å–å¼•ã‚’æ™‚åˆ»é †ã«ã‚½ãƒ¼ãƒˆ
2. å„å–å¼•æ™‚ç‚¹ã§ã®åœ¨åº«æ®‹é«˜ã‚’è¨ˆç®—
3. åœ¨åº«ä¸è¶³ã§å®Ÿè¡Œã•ã‚Œã‚‹å–å¼•ã‚’ã‚¢ãƒ©ãƒ¼ãƒˆå¯¾è±¡ã¨ã™ã‚‹

#### ãƒ•ã‚§ãƒ¼ã‚º2: åœ¨åº«0ã‚¢ãƒ©ãƒ¼ãƒˆã®å†å®šç¾©
1. ã€Œåœ¨åº«ãŒãªã„çŠ¶æ…‹ã§ã®å£²ä¸Šã€ã®ã¿ã‚’ã‚¢ãƒ©ãƒ¼ãƒˆ
2. ã€Œçµæžœçš„ã«åœ¨åº«ãŒ0ã«ãªã‚‹ã€ã“ã¨ã¯æ­£å¸¸ã¨ã—ã¦æ‰±ã†
3. ãƒžã‚¤ãƒŠã‚¹åœ¨åº«ã¯åˆ¥é€”ã€Œãƒžã‚¤ãƒŠã‚¹åœ¨åº«ã‚¢ãƒ©ãƒ¼ãƒˆã€ã¨ã—ã¦åˆ†é¡ž

### ðŸ“Š å½±éŸ¿ç¯„å›²

#### ä¿®æ­£ã«ã‚ˆã‚Šè§£æ±ºã•ã‚Œã‚‹å•é¡Œ
1. âœ… åŒæ—¥å£²ä¸Šãƒ»ä»•å…¥ç›¸æ®ºã«ã‚ˆã‚‹èª¤ã‚¢ãƒ©ãƒ¼ãƒˆã®é™¤åŽ»
2. âœ… æ­£å¸¸ãªå–å¼•ã«å¯¾ã™ã‚‹ãƒŽã‚¤ã‚ºã‚¢ãƒ©ãƒ¼ãƒˆã®å‰Šæ¸›
3. âœ… çœŸã®åœ¨åº«ä¸è¶³å•é¡Œã®æ­£ç¢ºãªæ¤œå‡º

#### æ³¨æ„ãŒå¿…è¦ãªç‚¹
1. âš ï¸ æ—¢å­˜ã®ã€Œåœ¨åº«0ã€ã‚¢ãƒ©ãƒ¼ãƒˆã«ä¾å­˜ã—ãŸé‹ç”¨ã®è¦‹ç›´ã—ãŒå¿…è¦
2. âš ï¸ æ™‚ç³»åˆ—å‡¦ç†ã«ã‚ˆã‚‹ãƒ‘ãƒ•ã‚©ãƒ¼ãƒžãƒ³ã‚¹å½±éŸ¿ã®æ¤œè¨¼ãŒå¿…è¦
3. âš ï¸ éŽåŽ»ã®ã‚¢ãƒ³ãƒžãƒƒãƒãƒªã‚¹ãƒˆçµæžœã¨ã®æ•´åˆæ€§ç¢ºèªãŒå¿…è¦

### ðŸ çµè«–

**ç¾åœ¨ã®åœ¨åº«0åˆ¤å®šãƒ­ã‚¸ãƒƒã‚¯ã¯æ ¹æœ¬çš„ã«é–“é•ã£ã¦ãŠã‚Šã€æ­£å¸¸ãªæ¥­å‹™å–å¼•ã‚’èª¤ã£ã¦ã‚¢ãƒ©ãƒ¼ãƒˆå¯¾è±¡ã¨ã—ã¦ã„ã‚‹ã€‚**

- åŒæ—¥ã«ç™ºç”Ÿã—ãŸå£²ä¸Šã¨ä»•å…¥ãŒç›¸æ®ºã—ã¦DailyStock=0ã«ãªã‚‹ã“ã¨ã¯æ­£å¸¸ãªæ¥­å‹™ãƒ•ãƒ­ãƒ¼
- çœŸã®å•é¡Œã¯ã€Œåœ¨åº«ãŒãªã„æ™‚ç‚¹ã§ã®å£²ä¸Šç™ºç”Ÿã€ã§ã‚ã‚Šã€ã€Œçµæžœçš„ãªåœ¨åº«0ã€ã§ã¯ãªã„
- ä¿®æ­£ã«ã¯å–å¼•ã®æ™‚ç³»åˆ—å‡¦ç†ãŒå¿…è¦ã§ã€è¨­è¨ˆãƒ¬ãƒ™ãƒ«ã§ã®å¤‰æ›´ãŒå¿…è¦

**ç·Šæ€¥åº¦: é«˜** - ç¾åœ¨ã®ã‚·ã‚¹ãƒ†ãƒ ã¯èª¤ã£ãŸã‚¢ãƒ©ãƒ¼ãƒˆã‚’å¤§é‡ç”Ÿæˆã—ã¦ã„ã‚‹å¯èƒ½æ€§ãŒé«˜ã„

---

**èª¿æŸ»è€…**: Claude Code  
**èª¿æŸ»å®Œäº†æ—¥æ™‚**: 2025å¹´7æœˆ26æ—¥  
**æ¬¡ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³**: ãƒ­ã‚¸ãƒƒã‚¯ä¿®æ­£ã®è©³ç´°è¨­è¨ˆãŠã‚ˆã³å®Ÿè£…æ–¹é‡ã®ç­–å®š